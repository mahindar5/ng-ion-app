import{a as ie}from"./chunk-OXIDU4F6.js";import{a as ne}from"./chunk-FMND2LCY.js";import{b as te}from"./chunk-2YCEMBZV.js";import{A as X,C as Y,a as G,da as Z,fa as $,ga as ee,o as J,v as K,w as Q}from"./chunk-CSTODAPL.js";import{A as O}from"./chunk-G7HGPG5R.js";import{C as V,D as N,K as W,N as D,X as L,Y as R,fa as U,ia as j,ja as q,m as E,p as k,ra as H,s as v,t as B,wa as z}from"./chunk-DG4AZ3SZ.js";import{$a as x,$b as M,Aa as a,Eb as P,Fb as b,Gb as S,Ja as A,Na as I,_a as w,da as h,ea as C,eb as p,fb as i,gb as l,hb as d,ka as F,kb as y,nb as g,ob as _,zb as T}from"./chunk-K2KEBQBS.js";import"./chunk-UWWRSBJN.js";import"./chunk-GJA76NSQ.js";import"./chunk-SL7YA7MF.js";import"./chunk-5UTXTVDX.js";import"./chunk-K37BZDXQ.js";import"./chunk-CASY3UTO.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-JR2FMVVP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as c,b as m}from"./chunk-3GJFFWBB.js";function se(o,oe){if(o&1){let e=y();i(0,"ion-button",14),g("click",function(){h(e);let n=_();return C(n.onProcessFiles())}),d(1,"ion-icon",15),l()}if(o&2){let e=_();p("disabled",e.isProcessButtonDisabled())}}function le(o,oe){if(o&1){let e=y();i(0,"ion-button",16),g("click",function(){h(e);let n=_();return C(n.onStopProcessing())}),d(1,"ion-icon",17),l()}}var ye=(()=>{class o extends ne{allFiles=F([]);currentPrompt=M(()=>{let e=this.settings();return{name:e.selectedPrompt.name,type:e.selectedPrompt.type,prompt:`#INSTRUCTIONS:
${e.selectedPrompt.excludeCommonInstructions?"":O.join(`
`)}
${e.selectedPrompt.promptTextList.map(t=>t.text).join(`
`)}

#ROLE:
${e.selectedPrompt.role}`}},{equal:(e,t)=>e.name===t.name&&e.type===t.type&&e.prompt===t.prompt});constructor(){super(),G({close:Q,colorWandOutline:X,createOutline:Y,settingsOutline:$,send:Z,chatbubblesOutline:J,clipboardOutline:K,stopCircleOutline:ee})}ngOnInit(){super.ngOnInit()}async onProcessFiles(){this.isProcessing.set(!0),this.allFiles.update(e=>e.map(t=>m(c({},t),{status:"init"})));try{let e=this.allFiles().filter(t=>t.selected);if(e.length===0)throw new Error("No files selected for processing");await this.aiProcessingService.processFiles(e,this.currentPrompt().prompt,this.settings(),this.showAuthenticationAlert.bind(this),this.updateFileItemStatus.bind(this))}finally{this.isProcessing.set(!1),this.allFiles.update(e=>e.map(t=>t.status==="inprogress"?m(c({},t),{status:"unmodified"}):t))}}onStopProcessing(){this.allFiles.update(e=>e.map(t=>t.status==="inprogress"?m(c({},t),{status:"unmodified"}):t)),this.isProcessing.set(!1)}isProcessButtonDisabled(){return!this.currentPrompt().prompt||this.allFiles().length<1||this.isProcessing()}onFileUpdate(e){this.allFiles.set(e)}updateFileItemStatus(e,t,n,r){this.allFiles.update(s=>{let f=s.map(u=>u.path===e.path?m(c({},u),{status:t,code:n,error:r}):u);return f.some(u=>u.path===e.path)||f.push(m(c({},e),{status:t,code:n,error:r})),f})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=A({type:o,selectors:[["app-ai-agent"]],features:[I],decls:20,vars:9,consts:[["when","xs","content-id","main-content"],["side","end","content-id","main-content","type","overlay",3,"disabled"],[3,"isCompactView"],["id","main-content"],["slot","start"],["slot","end"],["title","Settings",3,"click"],["slot","icon-only","name","settings-outline"],[1,"ion-padding",3,"scrollEvents"],["label","Prompt","counter","true","color","primary","labelPlacement","stacked","placeholder","Type your prompt","fill","solid",3,"ngModelChange","rows","maxlength","ngModel"],[1,"send-button-container"],["fill","clear",3,"disabled"],["fill","clear","title","Stop Processing"],[3,"allFilesChange","allFiles","acceptReferences"],["fill","clear",3,"click","disabled"],["slot","icon-only","name","send"],["fill","clear","title","Stop Processing",3,"click"],["slot","icon-only","name","stop-circle-outline"]],template:function(t,n){if(t&1&&(i(0,"ion-split-pane",0)(1,"ion-menu",1)(2,"ion-content"),d(3,"app-settings",2),l()(),i(4,"div",3)(5,"ion-header")(6,"ion-toolbar")(7,"ion-buttons",4),d(8,"ion-menu-button"),l(),i(9,"ion-title"),T(10,"AI Agent"),l(),i(11,"ion-buttons",5)(12,"ion-button",6),g("click",function(){return n.toggleSideBarOpen("aiAgent")}),d(13,"ion-icon",7),l()()()(),i(14,"ion-content",8)(15,"ion-textarea",9),S("ngModelChange",function(s){return b(n.currentPrompt().prompt,s)||(n.currentPrompt().prompt=s),s}),i(16,"ion-buttons",10),w(17,se,2,1,"ion-button",11)(18,le,2,0,"ion-button",12),l()(),i(19,"app-file-manager",13),S("allFilesChange",function(s){return b(n.allFiles,s)||(n.allFiles=s),s}),l()()()()),t&2){let r;a(),p("disabled",!((r=n.settings().sideBarOpen)!=null&&r.aiAgent)),a(2),p("isCompactView",!0),a(11),p("scrollEvents",!0),a(),p("rows",7)("maxlength",5e4),P("ngModel",n.currentPrompt().prompt),a(2),x(n.isProcessing()?18:17),a(2),P("allFiles",n.allFiles),p("acceptReferences",!0)}},dependencies:[B,E,v,k,D,q,j,V,H,W,z,N,R,U,L,te,ie],styles:["#main-content[_ngcontent-%COMP%]{padding-bottom:60px}.send-button-container[_ngcontent-%COMP%]{bottom:20px;position:absolute;right:0}"]})}return o})();export{ye as AiAgentComponent};
