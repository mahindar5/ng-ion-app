import{D as te,G as ie,I as ne,L as oe,a as Y,aa as le,ba as re,ja as ae,q as ee}from"./chunk-CSTODAPL.js";import{E as L,a as Z}from"./chunk-AOXDPQU6.js";import{$ as G,B as N,C as Q,D as W,P as q,R as U,V as j,ka as H,m as $,na as J,p as z,qa as K,ra as X,t as B}from"./chunk-DG4AZ3SZ.js";import{$a as F,Aa as d,Ab as x,Eb as A,Fb as D,Gb as E,Ja as b,Mb as I,_ as h,_a as C,bc as R,cb as k,cc as O,da as s,db as y,dc as P,ea as c,eb as w,fb as l,gb as r,hb as _,kb as f,nb as u,ob as a,ub as V,vb as T,zb as v}from"./chunk-K2KEBQBS.js";import{a as M,b as S}from"./chunk-3GJFFWBB.js";var se=["dropZone"],ce=(n,p)=>p.path;function de(n,p){if(n&1){let e=f();l(0,"ion-button",11),u("click",function(){s(e);let t=a();return c(t.toggleSelectAllFiles())}),_(1,"ion-icon",12),r()}}function pe(n,p){if(n&1){let e=f();l(0,"ion-button",13),u("click",function(){s(e);let t=a();return c(t.saveAllFiles())}),_(1,"ion-icon",14),r()}}function me(n,p){if(n&1){let e=f();l(0,"ion-button",15),u("click",function(){s(e);let t=a();return c(t.clearFiles())}),_(1,"ion-icon",16),r()}}function _e(n,p){if(n&1){let e=f();l(0,"ion-button",25),u("click",function(){s(e);let t=a(2).$implicit,o=a();return c(o.saveFile(t))}),_(1,"ion-icon",26),r()}}function ue(n,p){if(n&1){let e=f();C(0,_e,2,0,"ion-button",22),l(1,"ion-button",23),u("click",function(){s(e);let t=a().$implicit,o=a();return c(o.saveFileAs(t))}),_(2,"ion-icon",24),r()}if(n&2){let e=a().$implicit;F(e.handle?0:-1)}}function ge(n,p){if(n&1&&(l(0,"ion-badge",28),v(1),r()),n&2){let e=a(2).$implicit;d(),x(e.referencesCount)}}function fe(n,p){if(n&1){let e=f();l(0,"ion-button",27),u("click",function(){s(e);let t=a().$implicit,o=a();return c(o.openReferenceModal(t))}),C(1,ge,2,1,"ion-badge",28),_(2,"ion-icon",29),r()}if(n&2){let e=a().$implicit;d(),F(e.referencesCount?1:-1)}}function Ce(n,p){if(n&1){let e=f();l(0,"ion-item-group"),_(1,"ion-progress-bar",17),l(2,"ion-item",18)(3,"ion-checkbox",19),E("ngModelChange",function(t){let o=s(e).$implicit;return D(o.selected,t)||(o.selected=t),c(t)}),r(),l(4,"ion-label"),v(5),r(),l(6,"ion-buttons",20),C(7,ue,3,1),C(8,fe,3,1,"ion-button",21),r()()()}if(n&2){let e=p.$implicit,i=a();d(),w("type",e.status==="inprogress"?"indeterminate":"determinate")("value",i.getProgressValue(e))("color",e.status==="error"?"danger":"primary"),d(),w("title",I("",e.error,` 
 
`,e.code)),d(),A("ngModel",e.selected),d(2),x(e.path),d(2),F(e.code!=null&&e.code.trim()?7:-1),d(),F(i.acceptReferences()?8:-1)}}var ye=(()=>{class n{fileService=Z(L);alertController=h(J);modalController=h(H);dropZoneRef=O("dropZone");allFiles=P.required();acceptReferences=R(!1);constructor(){Y({checkmarkDoneCircle:ee,documentOutline:te,folderOutline:ne,save:le,saveOutline:re,duplicateOutline:ie,trashOutline:ae,gitNetwork:oe})}async openReferenceModal(e){let{FileManagerModalComponent:i}=await import("./chunk-FHMUDT2I.js"),t=await this.modalController.create({component:i,componentProps:{allFiles:e.references||[]}});t.onDidDismiss().then(o=>{let m=o.data?.allFiles;m&&(e.references=m,e.referencesCount=m.filter(g=>g.selected).length,this.allFiles.set([...this.allFiles()]))}),await t.present()}toggleSelectAllFiles(){let e=this.allFiles().every(i=>i.selected);this.allFiles.set(this.allFiles().map(i=>S(M({},i),{selected:!e})))}onDragOver(e){e.preventDefault(),this.dropZoneRef()?.nativeElement.classList.add("drag-over")}onDragLeave(e){e.preventDefault(),this.dropZoneRef()?.nativeElement.classList.remove("drag-over")}async onFileDrop(e){e.preventDefault(),this.dropZoneRef()?.nativeElement.classList.remove("drag-over"),await this.updateFiles(()=>this.fileService.handleDrop(e))}async selectFolder(){await this.updateFiles(()=>this.fileService.selectFolder())}async selectFiles(){await this.updateFiles(()=>this.fileService.selectFiles())}async saveFile(e){e.handle?await this.fileService.writeToFile(e):await this.saveFileAs(e)}async saveFileAs(e){let i=await this.fileService.saveFileAs(e);i&&this.allFiles.set(this.allFiles().map(t=>t.path===e.path?i:t))}async saveAllFiles(){let e=this.allFiles().map(i=>this.saveFile(i));await Promise.all(e)}hasUnsavedChanges(){return this.allFiles().some(e=>e.status==="done"&&e.code?.trim())}clearFiles(){this.allFiles.set([])}getProgressValue(e){return e.status==="done"?1:e.status==="error"||e.status==="unmodified"?.5:0}async updateFiles(e){let i=await e();if(i.length===0)return;let t=this.allFiles();if(t.length===0){this.allFiles.set(i);return}await(await this.alertController.create({header:"Replace the list of Files",message:"Do you want to append, replace, or skip to add them?",buttons:[{text:"Replace",handler:()=>this.allFiles.set(i)},{text:"Skip",role:"cancel"},{text:"Append",handler:()=>{this.allFiles.set([...t,...i.filter(m=>!t.some(g=>g.path===m.path))])}}]})).present()}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=b({type:n,selectors:[["app-file-manager"]],viewQuery:function(i,t){i&1&&V(t.dropZoneRef,se,5),i&2&&T()},inputs:{allFiles:[1,"allFiles"],acceptReferences:[1,"acceptReferences"]},outputs:{allFiles:"allFilesChange"},decls:14,vars:3,consts:[["dropZone",""],[1,"button-container"],["fill","clear","title","Select All"],["fill","clear","title","Select Files",3,"click"],["slot","icon-only","name","document-outline"],["fill","clear","title","Select Folder",3,"click"],["slot","icon-only","name","folder-outline"],["fill","clear","title","Save All"],["fill","clear","title","Clear Files"],[1,"drop-zone",3,"dragover","dragleave","drop"],[1,"drop-message"],["fill","clear","title","Select All",3,"click"],["slot","icon-only","name","checkmark-done-circle"],["fill","clear","title","Save All",3,"click"],["slot","icon-only","name","save"],["fill","clear","title","Clear Files",3,"click"],["slot","icon-only","name","trash-outline"],[3,"type","value","color"],[3,"title"],["slot","start",3,"ngModelChange","ngModel"],["slot","end"],["title","Accept"],["title","Save"],["title","Save As",3,"click"],["slot","icon-only","name","duplicate-outline"],["title","Save",3,"click"],["slot","icon-only","name","save-outline"],["title","Accept",3,"click"],["color","primary"],["name","git-network"]],template:function(i,t){if(i&1){let o=f();l(0,"div",1),C(1,de,2,0,"ion-button",2),l(2,"ion-button",3),u("click",function(){return s(o),c(t.selectFiles())}),_(3,"ion-icon",4),r(),l(4,"ion-button",5),u("click",function(){return s(o),c(t.selectFolder())}),_(5,"ion-icon",6),r(),C(6,pe,2,0,"ion-button",7),C(7,me,2,0,"ion-button",8),r(),l(8,"div",9,0),u("dragover",function(g){return s(o),c(t.onDragOver(g))})("dragleave",function(g){return s(o),c(t.onDragLeave(g))})("drop",function(g){return s(o),c(t.onFileDrop(g))}),l(10,"div",10),v(11,"Drag and drop files here"),r()(),k(12,Ce,9,10,"ion-item-group",null,ce)}i&2&&(d(),F(t.allFiles().length>0?1:-1),d(5),F(t.hasUnsavedChanges()?6:-1),d(),F(t.allFiles().length>0?7:-1),d(5),y(t.allFiles()))},dependencies:[B,$,z,Q,W,K,X,q,U,j,G,N],styles:[".drop-zone[_ngcontent-%COMP%]{border:2px dashed #ccc;border-radius:10px;margin-bottom:20px;padding:20px;position:relative;text-align:center;transition:border-color .3s ease,color .3s ease}.drop-zone.drag-over[_ngcontent-%COMP%]{border-color:#777;color:#777}.drop-message[_ngcontent-%COMP%]{color:#aaa;font-size:20px;padding:10px}.button-container[_ngcontent-%COMP%]{display:flex;gap:4px;position:absolute;right:20px;z-index:10}"]})}return n})();export{ye as a};
