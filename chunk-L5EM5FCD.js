import{a as ie}from"./chunk-KQDSADAZ.js";import{a as ne}from"./chunk-G2JG7X7E.js";import{b as te}from"./chunk-HN7SCMPT.js";import{B as Y,ca as Z,ea as $,fa as ee,n as J,u as K,v as Q,z as X}from"./chunk-LJYLQJYK.js";import{A as O}from"./chunk-6O37ENHY.js";import{C as N,D as V,K as W,N as D,X as L,Y as R,fa as U,ia as j,ja as q,m as v,p as E,ra as H,s as k,t as B,wa as z}from"./chunk-QAB2KOB3.js";import{$a as x,Aa as a,Cb as M,Hb as y,Ib as P,Ja as A,Jb as S,Na as I,_a as w,cc as T,da as h,ea as C,eb as p,fb as i,gb as s,hb as d,ka as F,nb as b,qb as g,rb as _}from"./chunk-MJ4XJREV.js";import"./chunk-UWWRSBJN.js";import{a as G}from"./chunk-PE2J6P5Y.js";import"./chunk-LHBIE3WG.js";import"./chunk-M7HIEP6N.js";import"./chunk-3VHKZABS.js";import"./chunk-BIEIEMQH.js";import"./chunk-CASY3UTO.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-JR2FMVVP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as c,b as m}from"./chunk-3GJFFWBB.js";function le(o,oe){if(o&1){let e=b();i(0,"ion-button",14),g("click",function(){h(e);let n=_();return C(n.onProcessFiles())}),d(1,"ion-icon",15),s()}if(o&2){let e=_();p("disabled",e.isProcessButtonDisabled())}}function se(o,oe){if(o&1){let e=b();i(0,"ion-button",16),g("click",function(){h(e);let n=_();return C(n.onStopProcessing())}),d(1,"ion-icon",17),s()}}var be=(()=>{class o extends ne{allFiles=F([]);currentPrompt=T(()=>{let e=this.settings();return{name:e.selectedPrompt.name,type:e.selectedPrompt.type,prompt:`#INSTRUCTIONS:
${e.selectedPrompt.excludeCommonInstructions?"":O.join(`
`)}
${e.selectedPrompt.promptTextList.map(t=>t.text).join(`
`)}

#ROLE:
${e.selectedPrompt.role}`}},{equal:(e,t)=>e.name===t.name&&e.type===t.type&&e.prompt===t.prompt});constructor(){super(),G({close:Q,colorWandOutline:X,createOutline:Y,settingsOutline:$,send:Z,chatbubblesOutline:J,clipboardOutline:K,stopCircleOutline:ee})}ngOnInit(){super.ngOnInit()}async onProcessFiles(){this.isProcessing.set(!0),this.allFiles.update(e=>e.map(t=>m(c({},t),{status:"init"})));try{let e=this.allFiles().filter(t=>t.selected);if(e.length===0)throw new Error("No files selected for processing");await this.aiProcessingService.processFiles(e,this.currentPrompt().prompt,this.settings(),this.showAuthenticationAlert.bind(this),this.updateFileItemStatus.bind(this))}finally{this.isProcessing.set(!1),this.allFiles.update(e=>e.map(t=>t.status==="inprogress"?m(c({},t),{status:"unmodified"}):t))}}onStopProcessing(){this.allFiles.update(e=>e.map(t=>t.status==="inprogress"?m(c({},t),{status:"unmodified"}):t)),this.isProcessing.set(!1)}isProcessButtonDisabled(){return!this.currentPrompt().prompt||this.allFiles().length<1||this.isProcessing()}onFileUpdate(e){this.allFiles.set(e)}updateFileItemStatus(e,t,n,r){this.allFiles.update(l=>{let f=l.map(u=>u.path===e.path?m(c({},u),{status:t,code:n,error:r}):u);return f.some(u=>u.path===e.path)||f.push(m(c({},e),{status:t,code:n,error:r})),f})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=A({type:o,selectors:[["app-ai-agent"]],features:[I],decls:20,vars:9,consts:[["when","xs","content-id","main-content"],["side","end","content-id","main-content","type","overlay",3,"disabled"],[3,"isCompactView"],["id","main-content"],["slot","start"],["slot","end"],["title","Settings",3,"click"],["slot","icon-only","name","settings-outline"],[1,"ion-padding",3,"scrollEvents"],["label","Prompt","counter","true","color","primary","labelPlacement","stacked","placeholder","Type your prompt","fill","solid",3,"ngModelChange","rows","maxlength","ngModel"],[1,"send-button-container"],["fill","clear",3,"disabled"],["fill","clear","title","Stop Processing"],[3,"allFilesChange","allFiles","acceptReferences"],["fill","clear",3,"click","disabled"],["slot","icon-only","name","send"],["fill","clear","title","Stop Processing",3,"click"],["slot","icon-only","name","stop-circle-outline"]],template:function(t,n){if(t&1&&(i(0,"ion-split-pane",0)(1,"ion-menu",1)(2,"ion-content"),d(3,"app-settings",2),s()(),i(4,"div",3)(5,"ion-header")(6,"ion-toolbar")(7,"ion-buttons",4),d(8,"ion-menu-button"),s(),i(9,"ion-title"),M(10,"AI Agent"),s(),i(11,"ion-buttons",5)(12,"ion-button",6),g("click",function(){return n.toggleSideBarOpen("aiAgent")}),d(13,"ion-icon",7),s()()()(),i(14,"ion-content",8)(15,"ion-textarea",9),S("ngModelChange",function(l){return P(n.currentPrompt().prompt,l)||(n.currentPrompt().prompt=l),l}),i(16,"ion-buttons",10),w(17,le,2,1,"ion-button",11)(18,se,2,0,"ion-button",12),s()(),i(19,"app-file-manager",13),S("allFilesChange",function(l){return P(n.allFiles,l)||(n.allFiles=l),l}),s()()()()),t&2){let r;a(),p("disabled",!((r=n.settings().sideBarOpen)!=null&&r.aiAgent)),a(2),p("isCompactView",!0),a(11),p("scrollEvents",!0),a(),p("rows",7)("maxlength",5e4),y("ngModel",n.currentPrompt().prompt),a(2),x(n.isProcessing()?18:17),a(2),y("allFiles",n.allFiles),p("acceptReferences",!0)}},dependencies:[B,v,k,E,D,q,j,N,H,W,z,V,R,U,L,te,ie],styles:["#main-content[_ngcontent-%COMP%]{padding-bottom:60px}.send-button-container[_ngcontent-%COMP%]{bottom:20px;position:absolute;right:0}"]})}return o})();export{be as AiAgentComponent};
